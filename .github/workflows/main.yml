name: Deploy from Dev Repo to Prod Databricks Workspace

on:
  push:
    branches:
      - main  # Trigger deployment on pushes to main branch

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # Checkout the repository code (code committed by Dev workspace)
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          ref: main

      # Setup Python environment (if you need Python tooling)
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'

      # Install Python dependencies (optional)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      # Setup Databricks CLI (latest version)
      - name: Setup Databricks CLI
        uses: databricks/setup-cli@main

      # Deploy assets (e.g., notebooks folder) from repo to Prod workspace
      - name: Deploy to Prod Databricks Workspace
        env:
          DATABRICKS_HOST: ${{ secrets.PRD_DEPLOY_URL }}
          DATABRICKS_TOKEN: ${{ secrets.PRD_DEPLOY_TOKEN }}
        run: |
          databricks workspace import_dir ./notebooks /Users/lesteveron@gmail.com/notebooks --overwrite


